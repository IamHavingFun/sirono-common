<apex:page standardController="Contact" Extensions="ProcessPayment" id="pg">
	<apex:includeScript value="{!URLFOR($Resource.PayStaffJS)}"/>
	<apex:stylesheet value="{!URLFOR($Resource.PayStaffStyle)}"/>
    <apex:sectionHeader title="Take Payment"/>
    <apex:form id="frm">
    	<apex:outputPanel id="errorPanel">
        	<apex:pageMessages />
        </apex:outputPanel>
        <apex:outputPanel id="statusPanel" styleClass="pay-staff-outer_block" style="display:none;">
        	<div class="pay-staff-inner_block">
        		<apex:image value="{!$Resource.ajax_loader}" height="36px" width="36px"/><br/>
        		<span class="pay-staff-custom_message">Refreshing...</span><br/>
        		<br/><br/><br/>
        	</div>
        </apex:outputPanel>
    	<apex:actionFunction name="refreshJS" action="{!doNext}"/>
    	<apex:pageBlock title="{!guarantorName}">
            <apex:outputPanel styleClass="pay-staff-table-wrap" rendered="{!chrageGroupList.size != 0}">
			    <table class="list">
			        <tr class="headerRow">
			            <td class="headerRow">
			            	<apex:outputPanel styleClass="selectAllHeader">
                            	<apex:inputCheckbox title="Select All" selected="false" styleClass="selectAllCBK" 
                            		onclick="selectAllCheckboxes(this,'inputId');startAjaxLoader('pg:frm:statusPanel');refreshJS();"/>
                            	<apex:outputLabel value="Select All" />
                        	</apex:outputPanel>
                        </td>
			            <td class="headerRow">Account</td>
			            <td class="headerRow">Type</td>
           				<td class="headerRow">Service Dates</td>
           				<td class="headerRow">Provider or Location</td>
           				<td class="headerRow">Balance</td>
           				<td class="headerRow">Invoice Date</td>
           				<td class="headerRow">Status</td>
			        </tr>
			    </table>
			    <div class="pay-staff-inner-table">
			        <table class="list">
				        <apex:repeat value="{!chrageGroupList}" var="cgw">
		            		<tr class="dataRow">
		            			<td class="dataCell">
		            				<apex:inputCheckbox value="{!cgw.isSelected}" id="inputId" styleClass="selectCBK" 
	                    				onclick="checkBoxStatus();startAjaxLoader('pg:frm:statusPanel');refreshJS();"/>
		            			</td>
		            			<td class="dataCell"><apex:outputField value="{!cgw.cg.Account_Number__c}"/></td>
		            			<td class="dataCell"><apex:outputField value="{!cgw.cg.Account_Type__c}"/></td>
		            			<td class="dataCell">
		            				<apex:outputField value="{!cgw.cg.Date_Of_Service_Start_Date__c}"/>-
		            				<apex:outputField value="{!cgw.cg.Date_Of_Service_End_Date__c}"/>
		            			</td>
		            			<td class="dataCell">
		            				<apex:outputField value="{!cgw.cg.Provider__r.Name}" rendered="{!cgw.cg.Account_Type__c == 'PB'}"/>
		            				<apex:outputField value="{!cgw.cg.Location__r.Name}" rendered="{!cgw.cg.Account_Type__c == 'HB'}"/>
		            			</td>
                                <td class="dataCell"><apex:outputField value="{!cgw.cg.Balance__c}"/></td>
                                <td class="dataCell"><apex:outputField value="{!cgw.cg.Invoice__r.Invoice_Date__c}"/></td>
		            			<td class="dataCell"><apex:outputField value="{!cgw.cg.Account_Status__c}"/></td>
		            		</tr>
            			</apex:repeat>
			    	</table>
			    </div>
			</apex:outputPanel>
			<apex:outputLabel value="There are no charge groups" rendered="{!chrageGroupList.size == 0}"/>
		</apex:pageBlock>
	    <br/>
	    <div class="pay-staff-clear-both pay-staff-bottom-line"></div>
	    <br/>
        <apex:outputPanel id="op">
            <div class="pay-staff-full-width pay-staff-clear-both">
	            <table class="pay-staff-tabale-left">
	            	<tr>
	            		<td colspan="3"> <apex:outputLabel styleClass="pay-staff-lable" value="Amount" for="amount"/> </td>
	            	</tr>
	            	<tr>
	            		<td colspan="3"> <apex:inputText styleClass="pay-staff-input" value="{!amount}" id="amount"/> </td>
	            	</tr>
	            	
	            	<tr>
	            		<td colspan="3"> <apex:outputLabel styleClass="pay-staff-lable" value="Name on Card" for="cardholderName"/> </td>
	            	</tr>
	            	<tr>
	            		<td colspan="3"> <apex:inputText styleClass="pay-staff-input" value="{!cardholderName}" id="cardholderName"/> </td>
	            	</tr>
	            	
	            	<tr>
	            		<td colspan="3"> <apex:outputLabel styleClass="pay-staff-lable" value="Card Number" for="cardNumber"/> </td>
	            	</tr>
	            	<tr>
	            		<td colspan="3"> <apex:inputText styleClass="pay-staff-input" value="{!creditCardNumber}" id="cardNumber"/> </td>
	            	</tr>
	            	
	            	<tr>
	            		<td colspan="2"> <apex:outputLabel styleClass="pay-staff-lable" value="Expiration Date" for="expYr"/> </td>
	            		<td> <apex:outputLabel styleClass="pay-staff-lable" value="CCV" for="ccv"/> </td>
	            	</tr>
	            	<tr>
	            		<td> 
	            			<apex:selectList styleClass="pay-staff-input" value="{!expirationMonth}" 
	            				multiselect="false" size="1" id="expMonth">
					            <apex:selectOptions value="{!expMonthOptions}"/>
					        </apex:selectList>
					    </td>
	            		<td>
	            			<apex:selectList styleClass="pay-staff-input" value="{!expirationYear}" 
	            				multiselect="false" size="1" id="expYr">
					            <apex:selectOptions value="{!expYearOptions}"/>
					        </apex:selectList> 
					    </td>
	            		<td> <apex:inputText styleClass="pay-staff-input" value="{!CVV}" id="ccv"/> </td>
	            	</tr>
	            	
	            	<tr>
	            		<td colspan="3"> <apex:outputLabel styleClass="pay-staff-lable" value="Billing Address" for="billAddr"/> </td>
	            	</tr>
	            	<tr>
	            		<td colspan="3"> <apex:inputText styleClass="pay-staff-input" value="{!address}" id="billAddr"/> </td>
	            	</tr>
	            	
	            	<tr>
	            		<td> <apex:outputLabel styleClass="pay-staff-lable" value="City" for="city"/> </td>
	            		<td> <apex:outputLabel styleClass="pay-staff-lable" value="State" for="state"/> </td>
	            		<td> <apex:outputLabel styleClass="pay-staff-lable" value="Zip Code" for="zip"/> </td>
	            	</tr>
	            	<tr>
	            		<td> <apex:inputText styleClass="pay-staff-input" value="{!city}" id="city"/> </td>
	            		<td> <apex:inputText styleClass="pay-staff-input" value="{!state}" id="state"/> </td>
	            		<td> <apex:inputText styleClass="pay-staff-input" value="{!zip}" id="zip"/> </td>
	            	</tr>
	            </table>
	            
	            <table class="pay-staff-tabale-right">
	            	<apex:variable var="totalAmount" value="{!0}" />
	            	<apex:repeat value="{!chrageGroupList}" var="cgw">
		            	<apex:outputPanel rendered="{!cgw.isSelected}">
		            		<apex:variable var="totalAmount" value="{!totalAmount + ABS(cgw.cg.Reported_Selfpay_Balance__c)}" />
			            	<tr class="pay-staff-cg-detail-row">
			            		<td>
			            			Account {!cgw.cg.Account_Number__c} 
			            		</td>
			            		<td class="pay-staff-text-right">{!ABS(cgw.cg.Reported_Selfpay_Balance__c)}</td>
			            	</tr>
		            	</apex:outputPanel>
	            	</apex:repeat>
	            	<tr class="pay-staff-cg-total-row">
		            	<td>
		            		Total
		            	</td>
		            	<td class="pay-staff-text-right">${!totalAmount}</td>
	            	</tr>
	            </table>
	            
            </div>
            <br/><div class="pay-staff-clear-both pay-staff-bottom-line"></div><br/>
            <div class="pay-staff-clear-both">
	            <table class="pay-staff-tabale-left">
	            	<tr>
		            	<td><apex:commandButton action="{!cancel}" value="Cancel" styleClass="pay-staff-button pay-staff-cancel-button"/></td>
		            	<td><apex:commandButton action="{!submit}" value="Submit" styleClass="pay-staff-button" rendered="{!chargeGroupsSelected}"/></td>
		            </tr>
	            </table>
            </div>
        </apex:outputPanel>
    </apex:form>
</apex:page>