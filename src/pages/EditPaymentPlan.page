<!--
  - Copyright (c) 2017-present Sirono LLC, All rights reserved
  -->

<apex:page controller="EditPaymentPlan" id="pg">
    <!--Sirono 08-29-2016:  Include JQuery-->
    <apex:includeScript value="{!URLFOR($Resource.Jquery, 'jquery-3.0.0.min.js')}"/>

    <apex:includeScript value="{!URLFOR($Resource.PayStaffJS)}"/>
    <apex:stylesheet value="{!URLFOR($Resource.PayStaffStyle)}"/>
    <apex:sectionHeader title="Save Edits"/>

    <Style>
        .input-symbol-dollar {
            position: relative;
        }

        .input-symbol-dollar input {
            padding-left: 28px;
        }

        .input-symbol-dollar:before {
            position: absolute;
            top: 1px;
            left: 1px;
            color: #000;
            padding: 7px 8px;
            font-size: 18px;
            font-weight: bold;
            background-color: #d3d3d3;
            content: "$";
            z-index: 9;
        }
    </Style>
    <apex:form id="frm">
        <apex:outputPanel id="errorPanel">
            <apex:pageMessages/>
        </apex:outputPanel>
        <apex:outputPanel id="statusPanel" styleClass="pay-staff-outer_block" style="display:none;">
            <div class="pay-staff-inner_block">
                <apex:image value="{!$Resource.ajax_loader}" height="36px" width="36px"/>
                <br/>
                <span class="pay-staff-custom_message">Refreshing...</span><br/>
                <br/><br/><br/>
            </div>
        </apex:outputPanel>
        <!--<apex:actionFunction name="refreshJS" action="{!doNext}"/>-->
        <apex:pageBlock title="{!guarantorName}">
            <apex:outputPanel id="op">
                <div class="pay-staff-full-width pay-staff-clear-both">
                    <table class="pay-staff-table-right" style="width:52%">
                        <tr>
                            <td colspan="2">
                                <apex:outputPanel rendered="{!chargeGroupList.size != 0}">
                                    <table class="list">
                                        <tr class="headerRow">
                                            <td class="headerRow" width="18%">Account</td>
                                            <td class="headerRow" width="10%">Type</td>
                                            <td class="headerRow" width="20%">Service Dates</td>
                                            <td class="headerRow" width="20%">Provider or Location</td>
                                            <td class="headerRow" width="10%">Balance</td>
                                            <td class="headerRow" width="5%">Invoice Date</td>
                                            <td class="headerRow" width="5%">Status</td>
                                            <td class="headerRow" width="10%">Sub-Status</td>
                                        </tr>
                                        <apex:repeat value="{!chargeGroupList}" var="cgw">
                                            <tr class="dataRow" width="2%">
                                                <td class="dataCell" width="18%">
                                                    <apex:outputField value="{!cgw.cg.External_ID__c}"/>
                                                </td>
                                                <td class="dataCell" width="10%">
                                                    <apex:outputField value="{!cgw.cg.Account_Type__c}"/>
                                                </td>
                                                <td class="dataCell" width="20%">
                                                    <apex:outputField value="{!cgw.cg.Date_Of_Service_Start_Date__c}"/>
                                                    -
                                                    <apex:outputField value="{!cgw.cg.Date_Of_Service_End_Date__c}"/>
                                                </td>
                                                <td class="dataCell" width="20%">
                                                    <apex:outputField value="{!cgw.cg.Provider__r.Name}"
                                                                      rendered="{!cgw.cg.Account_Type__c == 'PB'}"/>
                                                    <apex:outputField value="{!cgw.cg.Location__r.Name}"
                                                                      rendered="{!cgw.cg.Account_Type__c == 'HB'}"/>
                                                </td>
                                                <td class="dataCell" width="10%">
                                                    <apex:outputField value="{!cgw.cg.Balance__c}"/>
                                                </td>
                                                <td class="dataCell" width="5%">
                                                    <apex:outputField value="{!cgw.cg.Invoice__r.Date__c}"/>
                                                </td>
                                                <td class="dataCell" width="5%">
                                                    <apex:outputField value="{!cgw.cg.Account_Status__c}"/>
                                                </td>
                                                <td class="dataCell" width="10%">
                                                    <apex:outputField value="{!cgw.cg.Account_Sub_Status__c}"/>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </table>
                                </apex:outputPanel>
                                <apex:outputLabel value="There are no charge groups"
                                                  rendered="{!chargeGroupList.size == 0}"/>
                            </td>
                        </tr>
                        <tr class="pay-staff-cg-total-row">
                            <td>
                                Total
                            </td>
                            <td class="pay-staff-text-right">${!totalAmount}</td>
                        </tr>
                    </table>

                    <!-- PROMISE TO PAY PAYMENTS -->
                    <table class="pay-staff-table-left"
                           style="display:{!IF(planType == 'promise', '','none')};width:44%;">
                        <tr>
                            <td colspan="2">
                                <apex:outputLabel styleClass="pay-staff-message"
                                                  value="Total Payment Plan: ${!payableAmount}"/>
                            </td>
                            <td colspan="2"> &nbsp;</td>
                        </tr>

                        <tr>
                            <td colspan="2">
                                <apex:outputLabel styleClass="pay-staff-label" value="Monthly Installment Amount"
                                                  for="amount2"/>
                            </td>
                            <td colspan="2"> &nbsp;</td>
                        </tr>
                        <tr>
                            <td colspan="2">
                            <span class="input-symbol-dollar">
                                <apex:inputText styleClass="pay-staff-input"
                                                onkeypress="return isDecimalNumberKey(event)" maxlength="15"
                                                value="{!promiseAmount}" id="amount2"/>
                            </span>
                            </td>

                            <td colspan="2"> &nbsp;</td>
                        </tr>
                    </table>

                    <!-- Automatic DRAFT PAYMENTS -->
                    <apex:outputPanel id="opAuto">
                        <table class="pay-staff-table-left"
                               style="display:{!IF(planType == 'auto', '','none')};width:44%;">
                            <tr>
                                <td colspan="3">
                                    <apex:outputLabel styleClass="pay-staff-message"
                                                      value="Total Payment Plan: ${!payableAmount}"/>
                                </td>
                            </tr>

                            <tr>

                                <td>
                                    <apex:outputLabel styleClass="pay-staff-label" value="Monthly Installment Amount"
                                                      for="amount"/>
                                </td>
                                <td> &nbsp;</td>
                                <td>
                                    <apex:outputLabel styleClass="pay-staff-label" value="Date to Charge (each month)"
                                                      for="executeOnDay"/>
                                </td>
                            </tr>
                            <tr>

                                <td>
                            <span class="input-symbol-dollar">
                                <apex:inputText styleClass="pay-staff-input"
                                                onkeypress="return isDecimalNumberKey(event)" maxlength="15"
                                                value="{!amount}" id="amount"/>
                            </span>
                                </td>
                                <td> &nbsp;</td>
                                <!--09-30-2016: Viraj Rana - Tracker #131322621: Date to Charge error to check the Date to Charge (each month) Enter only number between 1 to 31-->
                                <td>
                                    <apex:inputText styleClass="pay-staff-input" onkeypress="return isDecimalNumberKey(event)" value="{!executeOnDay}"
                                                    id="executeOnDay"/>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="3">
                                    <apex:outputLabel styleClass="pay-staff-label" style="float: left;"
                                                      value="Name on Card" for="cardholderName"/>
                                    <apex:commandLink style="float: right;color: blue;text-decoration: none;"
                                                      value="Fill Name and Address on File"
                                                      action="{!fillNameAndAddress}" reRender="opAuto"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <apex:inputText styleClass="pay-staff-input" value="{!cardholderName}"
                                                    id="cardholderName"/>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="3">
                                    <apex:outputLabel styleClass="pay-staff-label" value="Card Number"
                                                      for="cardNumber"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <apex:inputText styleClass="pay-staff-input" onkeypress="return isNumberKey(event)"
                                                    maxlength="19" value="{!creditCardNumber}" id="cardNumber"/>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="2">
                                    <apex:outputLabel styleClass="pay-staff-label" value="Expiration Date" for="expYr"/>
                                </td>
                                <td Style="padding-left: 4%;">
                                    <apex:outputLabel styleClass="pay-staff-label" value="CVV" for="ccv"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:selectList styleClass="pay-staff-input" value="{!expirationMonth}"
                                                     multiselect="false" size="1" id="expMonth">
                                        <apex:selectOptions value="{!expMonthOptions}"/>
                                    </apex:selectList>
                                </td>
                                <td Style="padding-left: 4%; width: 20%;">
                                    <apex:selectList styleClass="pay-staff-input" value="{!expirationYear}"
                                                     multiselect="false" size="1" id="expYr">
                                        <apex:selectOptions value="{!expYearOptions}"/>
                                    </apex:selectList>
                                </td>
                                <td Style="padding-left: 4%;">
                                    <apex:inputText styleClass="pay-staff-input" maxlength="4"
                                                    onkeypress="return isNumberKey(event)" value="{!cvv}" id="ccv"/>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="3">
                                    <apex:outputLabel styleClass="pay-staff-label" value="Billing Address"
                                                      for="billAddr"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <apex:inputText styleClass="pay-staff-input" value="{!address}" id="billAddr"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <table style="width:100%" class="pay-staff-table-left">
                                        <tr>
                                            <td width="60%">
                                                <apex:outputLabel styleClass="pay-staff-label" value="City" for="city"/>
                                            </td>
                                            <td width="25%" Style="padding-left: 4%;">
                                                <apex:outputLabel styleClass="pay-staff-label" value="State"
                                                                  for="state"/>
                                            </td>
                                            <td width="15%" Style="padding-left: 4%;">
                                                <apex:outputLabel styleClass="pay-staff-label" value="Zip Code"
                                                                  for="zip"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td width="60%">
                                                <apex:inputText styleClass="pay-staff-input" value="{!city}" id="city"/>
                                            </td>
                                            <td width="25%" Style="padding-left: 4%;">
                                                <apex:inputText styleClass="pay-staff-input" value="{!state}"
                                                                id="state"/>
                                            </td>
                                            <td width="15%" Style="padding-left: 4%;">
                                                <apex:inputText styleClass="pay-staff-input"
                                                                onkeypress="return isNumberKey(event)" maxlength="5"
                                                                value="{!zip}" id="zip"/>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </apex:outputPanel>
                </div>
                <br/>
                <div class="pay-staff-clear-both pay-staff-bottom-line"></div>
                <br/>
                <div class="pay-staff-clear-both">
                    <table class="pay-staff-table-left">
                        <tr>
                            <td>
                                <apex:commandButton action="{!cancel}" value="Cancel"
                                                    styleClass="pay-staff-button pay-staff-cancel-button"/>
                            </td>
                            <td>
                                <apex:commandButton action="{!doSubmit}" value="Save Edits"
                                                    styleClass="pay-staff-button"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </apex:outputPanel>
        </apex:pageBlock>
    </apex:form>

    <Script>
        //Sirono 08-29-2016: 127326579 when Record Saved Successfully return to the PaymentPlan after few Sec.
        var delaymessage = 2000;
        $(document).ready(function () {
            returnToContact();
        });

        function returnToContact() {
            $('img[title="INFO"]').each(function () {
                setTimeout(function () {
                    window.location = '/{!JSENCODE(paymentPlanRecordId)}';
                }, delaymessage);
            });
        }

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }

        function isDecimalNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode == 46 || charCode == 62) return true;
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }
    </Script>
</apex:page>